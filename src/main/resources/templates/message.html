<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>쪽지함</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- CSS File -->
    <link href="../static/message.css" rel="stylesheet">

    <!-- 메세지 전송 아이콘(종이비행기) 때문에 필요 -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.css" type="text/css"
          rel="stylesheet"/>
    <style>
        a {
            text-decoration: none;
            color: black;
        }

        .detail:hover {
            cursor: pointer;
        }
        .small-font {
            font-size: 15px;
        }

    </style>
</head>

<body>

<!-- 메뉴바
   현재페이지 뭔지 param.thisPage에 넣어서 navbar.jsp에  던짐 -->


<br/>
<br/><br/>
<div class="msg-container">

    <div class="messaging">
        <div class="inbox_msg">
            <!-- 메세지 목록 영역 -->
            <div class="inbox_people">
                <div class="headind_srch">
                    <div class="recent_heading">
                        <h4>Recent</h4>
                    </div>
                </div>

                <!-- 메세지 리스트 -->
                <!--                <form action="/message/detail?${no}" id="see">-->
                <div class="inbox_chat">
                    <div th:each="item : ${list}">
<!--                        <div class="detailBtn" type="button">-->
                        <a class="detailBtn" type="button">
                            <div><span th:text="'보낸이 : ' + ${item.send_nick}"/></div>
                            <div th:text="'제목 : ' + ${item.title}"></div></a>
                            <input type="hidden" name="no" class="no" th:value="${item.no}"
                                   th:attrappend="id=${itemStat.index}">
                            <br/>
                            <!-- 새로운 div 태그 추가 -->
                            <div style="border: 1px solid; border-color: black;">
                            </div>
                        </div>
                    </div>
                    </a>
                <a href="/message/write" onClick="window.open(this.href, '', 'width=550, height=502'); return false;">
                    <button>쪽지 보내기</button></a>
                </div>
            </div>
    </div>
            <!-- 메세지 내용 영역 -->
            <div class="mesgs">
                <!-- 메세지 내용 목록 -->
                <div class="msg_history" name="contentList">
                </div>

                <div class="send_message">
                </div>
                <!-- 메세지 입력란이 올자리 -->
            </div>

</div>
<script>

    $(".detailBtn").on("click",function (){

        $(".msg_history").empty();
        let no = $(this).next().val();
        $.ajax({
            url: "/message/detail",
            type: "POST",
            data: {
                "no": no
            },
            success: function (data) {

                // Remove the replyBtn element if it exists
                $(".mesgs button").remove();

                // Add the replyBtn element
            }

        }).done(function (data) {
                let target = JSON.parse(data)
            console.log(target);
                let div = $("<div>");

                let p2 = $("<p>");
                p2.append("보낸이 : " + target.send_nick);
                p2.addClass("small-font");
                p2.css("color", "grey");
                let p3 = $("<p>");
                p3.append("받는이 : " + target.recv_nick);
                p3.addClass("small-font");
                p3.css("color", "grey");
                let p4 = $("<p>");
                p4.append("보낸 시간 : " + target.send_time);
                p4.addClass("small-font");
                p4.css("color", "grey");
                let p5 = $("<p>");
                p5.append("<label>내용</label><br/><br/>");
                p5.append(target.content);
                p5.addClass("small-font");

                div.append(p2);
                div.append(p3);
                div.append(p4);
                div.append(p5);
                $(".msg_history").append(div);

                // let replyBtn = $("<button>");
                // replyBtn.text("답장하기");
                // $(".mesgs").append(replyBtn);

            let replyBtn = $("<button>");
            replyBtn.text("답장하기");
            $(".mesgs").append(replyBtn);
            replyBtn.on("click", function() {
                window.open("/message/write?replyTo=" + target.send_nick, "", "width=550, height=502");
            });
        });
    });

</script>
</body>
</html>